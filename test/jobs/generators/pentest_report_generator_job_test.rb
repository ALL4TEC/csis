# frozen_string_literal: true

require 'test_helper'
require 'utils/tmp_file_helper'

module Generators
  class PentestReportGeneratorJobTest < ActiveJob::TestCase
    include TmpFileHelper

    # Testing job
    test 'that pentest report generation is performed in french' do
      test_pentest_report_generation
    end

    test 'that pentest report generation is performed in english' do
      test_pentest_report_generation(:en)
    end

    private

    def test_pentest_report_generation(lang = :fr)
      pentest_report = PentestReport.first
      rep_exp = ReportExport.create!(report: pentest_report, exporter: pentest_report.staff)
      pentest_report.language = Language.find_by(iso: lang)
      pentest_report.save
      PentestReportGeneratorJob.perform_now(rep_exp.id)
      rep_exp.reload
      assert(rep_exp.document.attached?, 'No file generated!')
    end
  end
end
